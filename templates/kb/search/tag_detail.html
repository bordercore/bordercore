{% extends "base.html" %}

{% load get_doctype %}

{% block title %} KB :: Tag Detail {% endblock %}

{% block content %}

{% include "kb/header.html" %}

    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/bootstrap-tagsinput-custom.css" />
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/bootstrap-tagsinput.css" />
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/typeahead-bootstrap3.css" />

    <script type="text/javascript" src="{{ STATIC_URL }}js/bootstrap-tagsinput.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/typeahead.bundle.min.js"></script>

    <script type="text/javascript">

        $(document).ready(function() {

            var engine = new Bloodhound({
                name: 'tags',
                remote: '{% url 'tag_search' %}?query=%QUERY',
                datumTokenizer: function(d) { return Bloodhound.tokenizers.whitespace(d.val); },
                queryTokenizer: Bloodhound.tokenizers.whitespace
            });

            engine.initialize();

            $('#tag-filter').tagsinput({
                confirmKeys: [13, 188],
                tagClass: function(item) {
                    return 'label label-primary';
                },
                typeaheadjs: {
                    source: engine.ttAdapter(),
                    displayKey: 'value',
                    valueKey: 'value',
                    options: {'autoselect': true}
                }

            });

            $('#tag-filter').change(function(obj) {
                var tags = $('#tag-filter').tagsinput('items')
                window.location='{% url 'kb_search_tag_detail' 666 %}'.replace('666', tags);
            });

            $('#other_tags').change( function(event) {
                var new_tag = $(this).val();
                $('#tag-filter').tagsinput('add', new_tag)
            });

            $('#myTab a').click(function (e) {
                e.preventDefault()
                $(this).tab('show')
            })

            $('#myTab a:first').tab('show') // Select first tab

        });

    </script>

    <br />

    <div class="row" id="search_tags_searchform">
        <div class="col-md-10">

            <form id="tag-filter-form" class="form-inline" action="{% url 'kb_search_tag_detail' tag %}" method="get" autocomplete="off">
                <div class="form-group search_input">
                    <input id="tag-filter" class="form-control" type="text" name="taglist" value="{{ taglist }}" placeholder="Tag List" />
                </div>
                {% if tag_counts %}
                <div class="form-group search_input">
                    <label>&nbsp; &nbsp; Other tags:</label>
                    <select id="other_tags" class="form-control">
                        {% for tag, count in tag_counts %}
                            <option value="{{ tag }}">{{ tag }} ({{ count }})</option>
                        {% endfor %}
                    </select>
                </div>
                {% endif %}
            </form>
        </div>
    </div>

    <ul class="nav nav-tabs" id="myTab">
        {% for doctype in doctype_counts %}
            <li><a href="#{{ doctype.0 }}">{{ doctype_mapping|get_doctype:doctype.0 }} <span class="badge alert-info">{{ doctype.1 }}</span></a></li>
        {% endfor %}
    </ul>

    <div class="tab-content">

        <br />
        <div id="bordercore_bookmark" class="tab-pane fade in active">
            {% for match in info.matches.bordercore_bookmark %}
                <div class="row voffset">
                    <div class="col-md-12">
                        <a href="{{ match.url }}">{{ match.bordercore_bookmark_title.0 }}</a>
                    </div>
                </div>
            {% endfor %}
        </div>

        <div id="document" class="tab-pane fade in active">
            {% for match in info.matches.document %}
                <div class="row voffset">
                    <div class="col-md-12">
                        <a href="{% url 'document_detail' match.internal_id %}">{{ match.title }}</a>
                    </div>
                </div>
            {% endfor %}
        </div>

        <div id="bordercore_blog" class="tab-pane fade in active">
            {% for match in info.matches.bordercore_blog %}
                <div class="row voffset">
                    <div class="col-md-12">
                        <a href="{% url 'blog_list' match.internal_id %}">{{ match.bordercore_blogpost_title.0|default:"Blog Post" }}</a>
                    </div>
                </div>
            {% endfor %}
        </div>

        <div id="bordercore_todo" class="tab-pane fade in active">
            {% for match in info.matches.bordercore_todo %}
                <div class="row voffset">
                    <div class="col-md-12">
                        {{ match.bordercore_todo_task.0 }}  <span class="search_todo_date">{{ match.last_modified }}</span>
                    </div>
                </div>
            {% endfor %}
        </div>

     </div>
<br />
<a href="{{ request.META.HTTP_REFERER }}">Back</a>

{% endblock %}
