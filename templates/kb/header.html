{% block extra_head %}

    <script type="text/javascript" src="{{ STATIC_URL }}js/handlebars.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/typeahead.bundle.min.js"></script>
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/typeahead-bootstrap3.css" />

{% endblock %}

<script type="text/javascript" charset="utf-8">

   $(document).ready(function() {

        var myengine = new Bloodhound({
            datumTokenizer: function(data) {
                return Bloodhound.tokenizers.obj.whitespace(data.value);
            },
            remote: {
                url: '{% url 'kb_search_tags_booktitles' %}?term=%QUERY',
            },
            queryTokenizer: Bloodhound.tokenizers.whitespace,
            limit: 20
        });

        myengine.initialize();

        var template_source = $("#entry-template-what").html()

        $('#kbsearch').typeahead(
            {
                hint: true,
                highlight: true,
                minLength: 3
            }, {
                source: myengine.ttAdapter(),
                displayKey: 'value',
                templates: {
                    suggestion: Handlebars.compile(template_source)
                }
            });

        $('#kbsearch').on('keyup', function(event, selection) {
            if ((event.which && event.which == 13) || (event.keyCode && event.keyCode == 13)) {
                $('#search').submit();
                return false;
            } else {
                return true;
            }
        });

        $('#kbsearch').bind('typeahead:selected', function(obj, datum, name) {
            var url = null;
            var name = '_self';
            if (datum.type == 'Tag') {
                url = '{% url 'kb_search_tag_detail' 666 %}'.replace(666, datum.value);
            } else {
                name = 'search'
                url = '{{ STATIC_URL }}ebooks/' + datum.filename;
            }
            window.open(url, name)
        });

        $('#advanced_search_link').click( function(e) {
            $('#advanced_search_form').toggle();
        })

        $('#advanced_search_form').hide();

    });

</script>

{% verbatim %}
    <script id="entry-template-what" type="text/x-handlebars-template">
        <div>{{ debug }}
            <em>{{type}}</em> - {{value}}
        </div>
    </script>
{% endverbatim %}

<form id="search" class="form-inline" action="{% url 'search' %}" method="get" autocomplete="off">

<div class="row">

    <div class="col-md-10">

        <!-- <form id="search" class="form-inline" action="{% url 'search' %}" method="get" autocomplete="off"> -->
            <input type="hidden" id="facets" name="facets" value="" />

            <div class="form-group">

                <input id="kbsearch" class="form-control" type="text" name="search" value="{{ request.GET.search }}" placeholder="Search" />

            </div>

            <div class="form-group">

                <label>Limit</label>

                <select name="rows" class="form-control">
                    <option>100</option>
                    <option>200</option>
                    <option>1000</option>
                    <option>No limit</option>
                </select>

            </div>

            <div class="form-group">

                <label>Sort by</label>

                <select name="sort" class="form-control">
                    <option value="rank">Rank</option>
                    <option value="project_name">Project Name</option>
                </select>

            </div>

            <input class="btn btn-default" type="submit" name="Go" value="Search" />

            &nbsp; &nbsp; <a href="#" id="advanced_search_link">Advanced Search</a>

            <!-- </form> -->

    </div>

</div>

<div class="row voffset" id="advanced_search_form">

    <div class="col-md-10">

        <!-- <form id="search" class="form-inline" action="{% url 'search' %}" method="get" autocomplete="off"> -->

            <div class="form-group">

                <label>Boolean Search Type</label>

                <select name="boolean_search_type" class="form-control">
                    <option selected="selected">AND</option>
                    <option>OR</option>
                </select>

            </div>
            <div class="form-group">

                <label>Blob Search</label>

                <input type="checkbox" name="blob_search" />

            </div>

            <!-- <input class="btn btn-default" type="submit" name="Go" value="Search" /> -->

            <!-- </form> -->

    </div>

</div>

</form>
