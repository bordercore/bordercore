{% extends "base.html" %}

{% block title %} Notes {% endblock %}

{% block content %}

    <script type="text/javascript" src="{{ STATIC_URL }}js/typeahead.bundle.min.js"></script>
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/typeahead-bootstrap3.css" />
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/code_style.css" />

    <script type="text/javascript">

        $(document).ready(function() {

            var engine = new Bloodhound({
                name: 'tags',
                remote: {
                    url: '{% url 'tag_search' %}?query=%QUERY' + '&type=note',
                    wildcard: '%QUERY'
                },
                datumTokenizer: function(d) { return Bloodhound.tokenizers.whitespace(d.val); },
                queryTokenizer: Bloodhound.tokenizers.whitespace
            });

            engine.initialize();

            $('#tag-filter').typeahead({
                autoselect: true,
                minLength: 2
            }, {
                    display: 'value',
                    source: engine,
                    templates: {
                        suggestion: function(data) {
                            return '<div class="tt-suggest-page">' + data.value.replace(data._query, '<strong>' + data._query+ '</strong>') + '</div>';
                        }
                    }
                }
                                       );

            $('#tag-filter').bind('typeahead:selected', function(obj, datum, name) {
                window.location='{% url 'notes_list' %}?tagsearch=' + datum.value;
            }).bind('focus', function(obj) {
                $('#blog-search').val('');
            });

            $('#blog-search').bind('keyup', function(event, selection) {
                if ((event.which && event.which == 13) || (event.keyCode && event.keyCode == 13)) {
                    $('form#blog-search-form').submit();
                    return false;
                } else {
                    return true;
                }
            }).bind('focus', function(obj) {
                $('#tag-filter').val('');
            });

        });

    </script>

    {% include "common/show_messages.html" with offset="0" width="12" %}

    <div class="row mb-3">
        <div class="col-lg-12">

            <form class="form-inline" name="nav_form" id="blog-search-form" action="{% url 'notes_list' %}" method="get">
                <input name="is-notes-search" value="true" type="hidden" />
                <label class="mr-2">Search</label>
                <input autocomplete="off" class="mr-2 form-control" id="blog-search" type="text" name="search" value="{{ request.GET.search_item }}" accesskey="s" />

                <label class="mr-2">Tag Filter</label>
                <input class="form-control" id="tag-filter" type="text" value="{{ request.GET.tagsearch }}" autocomplete="off" />

                <a class="btn btn-primary ml-2" href="{% url 'blob_add' %}?is_note=true">Add note</a>

            </form>

        </div>
    </div>

    <div class="row">
        <div class="col-lg-12">

            {% for note in info %}

                <h2>
                    <a href="{% url 'blob_detail' note.uuid %}">{{ note.title|default:"Note Title" }}</a>
                </h2>

                <span class="glyphicon glyphicon-time"></span> <span class="muted"> {{ note.date }} </span>

                <br /><br />

                <div>
                    {{ note.content|safe }}
                </div>

                {% if note.tags %}

                    {% for tag in note.tags %}
                        <a class="badge badge-primary" href="{% url 'notes_list' %}?tagsearch={{ tag }}">{{ tag }}</a>
                    {% endfor %}

                {% endif %}

                <br /><br />

            {% endfor %}

        </div>
    </div>


    {% if object_list and object_list.paginator.num_pages > 1 %}

        <nav class="mb-5">
            {% if object_list.has_previous %}
                <a class="btn btn-primary" href="?page={{ object_list.previous_page_number }}&tagsearch={{ request.GET.tagsearch }}&search_item={{ request.GET.search_item }}">previous</a>
            {% endif %}
            Page <strong>{{ object_list.number }}</strong> of <strong>{{ object_list.paginator.num_pages }}</strong>
            {% if object_list.has_next %}
                <a class="btn btn-primary" href="?page={{ object_list.next_page_number }}&tagsearch={{ request.GET.tagsearch }}&search_item={{ request.GET.search_item }}">next</a>
            {% endif %}
        </nav>

    {% endif %}

{% endblock %}
