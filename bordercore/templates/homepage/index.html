{% extends "base.html" %}

{% load favicon %}

{% block title %} Home {% endblock %}

{% block content %}

    <div id="vue-app">

        <div class="row no-gutters">

            <div class="col-lg-3">

                <card>
                    <template v-slot:title-slot>
                        <div class="card-title">
                            <a href="{% url 'todo:list' %}">Important Tasks</a>
                        </div>
                    </template>
                    <template v-slot:content>
                        <ul class="list-group interior-borders">
                            {% for task in tasks %}
                                <li class="list-group-item list-group-item-secondary text-primary">{{ task.name }}
                                    <span class="badge badge-info ml-1">{{ task.parent_category }}</span>
                                    {% for tag in task.tags.all %}
                                        <span class="badge badge-info">{{ tag.name }}</span>
                                    {% endfor %}
                                </li>
                            {% empty %}
                                <li class="list-group-item list-group-item-secondary">All done!</li>
                            {% endfor %}
                        </ul>
                    </template>
                </card>

                <div>

                    <card title="Drill Total Progress">
                        <template v-slot:title-slot>
                            <div class="card-title">
                                <a href="{% url 'drill:list' %}">Drill Total Progress</a>
                            </div>
                        </template>
                        <template v-slot:content>
                            <div class="d-flex">
                                <div class="d-flex justify-content-center align-items-center">
                                Percentage across all tags of questions not needing review
                                </div>
                                <drill-tag-progress
                                    :count={{ drill_total_progress.count }}
                                    :progress={{ drill_total_progress.percentage }}
                                >
                                </drill-tag-progress>
                            </div>
                        </template>
                    </card>

                </div>

                <div>

                    <card title="Overdue Exercises">
                        <template v-slot:content>
                            <ul class="list-group interior-borders">
                                {% for exercise in overdue_exercises %}
                                    <li class="list-group-item list-group-item-secondary text-info"><a href="{% url 'fitness:exercise_detail' exercise.exercise.exercise.uuid %}">{{ exercise.exercise.exercise.name }}</a> {{ exercise.lag }} days</li>
                                {% empty %}
                                    <li class="list-group-item list-group-item-secondary">No active exercises.</li>
                                {% endfor %}
                            </ul>
                        </template>
                    </card>

                </div>

                <div>

                    <card title="Daily Bookmarks">
                        <template v-slot:content>
                            <ul class="list-group interior-borders">
                                {% for bookmark in daily_bookmarks %}
                                    <li class="list-group-item list-group-item-secondary {{ bookmark.css_class }}"><a href="{% url 'bookmark:click' bookmark.uuid %}">{{ bookmark.name }}</a></li>
                                {% empty %}
                                    <li class="list-group-item list-group-item-secondary">No bookmarks marked as Daily.</li>
                                {% endfor %}
                            </ul>
                        </template>
                    </card>

                </div>

                <div>

                    <card title="Pinned Bookmarks">
                        <template v-slot:content>
                            <ul class="list-group interior-borders">
                                {% for bookmark in pinned_bookmarks %}
                                    <li class="list-group-item list-group-item-secondary"><a href="{{ bookmark.url }}">{{ bookmark.name }}</a> </li>
                                {% empty %}
                                    <li class="list-group-item list-group-item-secondary">No pinned bookmarks.</li>
                                {% endfor %}
                            </ul>
                        </template>
                    </card>

                </div>

            </div> <!-- End first column -->

            <div class="col-lg-5">

                <card>
                    <template v-slot:title-slot>
                        <div class="card-title">
                            <a class="text-emphasis" href="{% url 'bookmark:overview' %}">Recent Bookmarks</a>
                        </div>
                    </template>
                    <template v-slot:content>
                        {% if bookmarks %}
                            <ul class="list-group interior-borders">
                            {% for bookmark in bookmarks %}
                                <li class="list-group-item list-group-item-secondary text-success">{{ bookmark.url|favicon:16|safe }} <a class="ml-2" href="{{ bookmark.url }}">{{ bookmark.name }}</a> </li>
                            {% endfor %}
                            </ul>
                        {% else %}
                            <li class="list-group-item list-group-item-secondary">
                                <a class="ml-2" href="{% url 'bookmark:create' %}">Add a bookmark</a>
                            </li>
                        {% endif %}
                    </template>
                </card>

                {% if default_collection %}
                    <div>
                        <card>
                            <template v-slot:title-slot>
                                <div class="card-title">
                                    <a href="{% url 'collection:detail' default_collection.uuid %}">{{ default_collection.name }}</a>
                                </div>
                            </template>
                            <template v-slot:content>
                                <ul class="list-group list-group-horizontal text-center list-unstyled">
                                    <li v-for="blob in blob_list" :key="blob.id">
                                        <a :href="[[ blob.url ]]"><img :src="[[ blob.cover_url ]]" /></a>
                                        <br/>
                                        <a :href="[[ blob.url ]]">[[ blob.name ]]</a> {% if blob.collection_note %}<img src="{{ STATIC_URL }}img/note.png" height="16" width="16" data-toggle="popover" data-content="[[ blob.collection_note ]]"/>{% endif %}
                                    </li>
                                </ul>
                            </template>
                        </card>
                    </div>
                {% endif %}

                <div>

                    <card title="Recently Played Music">
                        <template v-slot:content>
                            <ul class="list-group interior-borders">
                                    {% for song in music %}
                                        <li class="list-group-item list-group-item-secondary text-info">{{ song.song.title }} <strong>{{ song.song.artist }}</strong></li>
                                    {% empty %}
                                        <li class="list-group-item list-group-item-secondary">No music listened to.</li>
                                    {% endfor %}
                            </ul>
                        </template>
                    </card>

                </div>

                <div>

                    <card title="Quote">
                        <template v-slot:content>
                            <div>
                                {{ quote.quote }}<br /><strong>{{ quote.source }}</strong>
                            </div>
                        </template>
                    </card>

                </div>

            </div> <!-- End second column -->

            <div class="col-lg-4">

                <div class="right-column">

                    <card title="Calendar">
                        <template v-slot:content>
                            <ul class="list-group interior-borders" id="events">
                                <li v-if="waiting" :class="errorClass" class="list-group-item list-group-item-secondary">[[ msg ]]</li>
                                <li v-for="event in events" :key="event.count" class="list-group-item list-group-item-secondary text-primary">[[ event.start_pretty ]]: <strong class="text-emphasis">[[ event.summary ]]</strong> </li>
                            </ul>
                        </template>
                    </card>

                </div>

                <div class="right-column">
                    <card title="Random Image">
                        {% if random_image_info %}
                            <template v-slot:title-slot>
                                <div class="card-title">
                                    <a href="{% url 'blob:detail' random_image_info.uuid %}">{{ random_image_info.name }}</a>
                                </div>
                            </template>
                        {% endif %}
                        <template v-slot:content>
                            {% if random_image_info %}
                                <img src="{{ random_image_info.url }}" class="mw-100" data-toggle="modal" data-target="#myModal" />
                            {% else %}
                                <a href="{% url 'blob:create' %}">Add a blob</a>
                            {% endif %}
                        </template>
                    </card>

                </div>

            </div> <!-- End third column -->

        </div>

    </div>

    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog modal-dialog-centered w-75 mw-100" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <div>
                        <img src="{{ random_image_info.url }}" class="w-100"/>
                    </div>
                </div>
            </div>
        </div>
    </div>

{% endblock %}

{% block javascript %}

    {{ block.super }}

    <script type="text/javascript">

        Vue.mixin({ delimiters: ["[[", "]]"] });

        new Vue({
            el: "#vue-app",
            data() {
                return {
                    errorClass: "",
                    events: [],
                    msg: "Retrieving...",
                    waiting: true,
                    blob_list: [
                        {% for blob in default_collection.blob_list %}
                        {
                            id: {{ blob.id }},
                            cover_url: "{{ blob.cover_url}}",
                            uuid: "{{ blob.uuid }}",
                            name: "{{ blob.name|safe }}",
                            collection_note: "{{ blob.collection_note }}",
                            url: "{% url 'blob:detail' blob.uuid %}",
                            cover_url: "{{ blob.cover_url }}"
                        },
                        {% endfor %}
                    ]
                }
            },
            mounted() {
                axios.get("{% url 'homepage:get_calendar_events' %}")
                     .then(response => {
                         this.events = response.data;

                         if (response.data.length == 0) {
                             this.msg = "Your calendar is empty";
                         } else {
                             this.waiting = false;
                             this.msg = "";
                         };
                     }).catch(error => {
                         this.msg = error;
                         this.errorClass = "alert alert-danger";
                     })
            }
        });

    </script>

{% endblock %}
