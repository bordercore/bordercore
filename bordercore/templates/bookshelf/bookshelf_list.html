{% extends "base.html" %}

{% block title %} Bookshelf {% endblock %}

{% block extra_head %}
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery-ui.min.js"></script>
{% endblock %}

{% block content %}

    <script>

        $(document).ready(function() {

            $('[data-toggle="popover"]').popover({});

            $('#bookshelf_sortable').sortable(           {
                connectWith: '.bookshelf_sortable',
                stop: function(event, ui) {
                    var info = ui.item.attr('id').split(',')
                    $.ajax({
                        url: '{% url 'sort_bookshelf' %}',
                        type: "POST",
                        data: { shelf_id : info[0], blob_id : info[1], position:  (ui.item.index() + 1) }
                    });

                }
            });

            $( "#bookshelf_sortable" ).disableSelection();

        });

    </script>

    {% for id, properties in object_list.items %}
        <div class="row">
            <div class="col-lg-12">

                <h3>{{ properties.name }}</h3>
                <ul id="bookshelf_sortable">
                    {% for match in properties.blob_list %}
                        <li id="{{ id }},{{ match.internal_id }}" data-toggle="popover" title="Added {{ match.added_to_bookshelf }}" data-content="{{ match.note }}">
                            <img src="{{ match.cover_url }}" height="92" width="70"/>
                            <br/>
                            <a href="{% url 'blob_detail' match.sha1sum %}">{{ match.title.0 }}</a> {% if match.note %}<img src="{{ STATIC_URL }}/img/note.png" height="16" width="16" />{% endif %}
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    {% endfor %}

{% endblock %}
